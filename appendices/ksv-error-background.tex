%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Measurement Operators}
\label{sec:meas-ops}

First we introduce some preliminary definitions related to measurement.

A very common quantum operation entangles the results of one register
(called the \emph{target}) based on the value of another register (called the
\emph{control}). The most basic case of this is CNOT, or $\Lambda(X)$,
operator, which operates
on a control register of one qubit and a target register of one qubit.

\begin{equation}
\Lambda(X)\ket{y,z} \rightarrow \ket{y, z \oplus y}
\end{equation}

We have two ways of describing how CNOT is measuring in this case.
We can say CNOT is \emph{measuring with respect to the decomposition} of
the control registers, namely the computational basis, in that the
operation on the target register (flipping the bit) depend on decomposing the
control register in the basis $\{0,1\}$. We can also say that CNOT is
\emph{measuring a function} $f:\{0,1\} \rightarrow \{0,1\}$ which in this
case is simply the copy operator, $f(x) = x$. We can rewrite the equation
above as:

\begin{equation}
\Lambda(X)\ket{y,z} \rightarrow \ket{y, z \oplus f(y)}
\end{equation}

However, we know that the distinction between control and target registers
often depends on a particular basis. For example, we can flip the direction
of control and target in the CNOT case by conjugating both qubits with
Hadamard operators. The general characteristic of measurement operators
is that they are entangling, and that they can encode information about
one register in another in a very general way.
From the point of view of measurement, we call the control register the
\emph{object}, as in the state we are trying to measure, and the target register
is the \emph{instrument}, as in the state that we transform according to
projecting the measurement object in some orthogonal decomposition.

Let's begin with a simple but more general case of a measuring operator
$W$ which operates on a space decomposed into the subsystems $\mathcal{N}$
(the measurement object) and $\mathcal{K}$ (the measurement instrument)
according to the orthogonal decomposition
$\mathcal{N} = \bigoplus_j \mathcal{L}_j$, so-called because
each of the $\mathcal{L}_j$ are pairwise orthogonal subspaces.
$W$ will perform a different unitary
operator $U_j$ on the subsystem $\mathcal{K}$
depending on the projection of $\mathcal{N}$ into each $\mathcal{L}_j$.

\begin{equation}
W = \sum_{j \in \Omega} \Pi_{\mathcal{L}_j} \otimes U_j
\end{equation}

An interesting fact about this definition of measurement operators is
that approximativeness is preserved. If each unitary $U_j$ is replaced with
another unitary $\tilde{U}_j$ that approximates it with precision $\delta$,
then the new measuring operator $\tilde{W}$ also approximates the original
$W$ with the precision $\delta$.

This precision is defined in terms of the inner product between any state
$\ket{\zeta}$
operated
on by $W$ and by $\tilde{W}$. We can decompose $\ket{\zeta}$ into
two subsystems $\ket{\psi}$ and $\ket{\phi}$
corresponding to the spaces $\mathcal{N}$ and $\mathcal{K}$
above. We will use this fact later.

\begin{equation}
\bra{\zeta} W^{\dag} \tilde{W} \ket{\zeta} =
\bra{\psi} \otimes \bra{\phi} W^{\dag} \tilde{W} \ket{\psi} \otimes \ket{\phi} =
\sum_{j \in \Omega} \left( \bra{\psi} \Pi_{\mathcal{L}_j} \ket{\psi} \otimes
\bra{\phi} U^{\dag}_j \tilde{U}_j \ket{\phi} \right) \le \delta
\end{equation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notation}

A random section on notation. I will find a better place to put this later.

In \cite{Kitaev2002}, ancillae are denoted as $\mathcal{B}^{\otimes N}$ to mean
appending $N$ qubits to a quantum state. However, we will use the more general
symbol $\mathcal{J}$ to mean any ancillary register of $N$ qudits of dimension $d$.
In context,
when we mean an ancillae state initialized to all zeros, we will write
$\ket{0^N}$ where $N = \log_d(\dim(\mathcal{J}))$.

In these notes we will mainly deal with unitary operators $U$, which by
definition operate on
states from some vector space $\mathcal{V}$
without enlarging or shrinking the space.
We can think of them as being square
$\dim(\mathcal{V}) \times \dim(\mathcal{V})$
unitary matrices.
However, mathematically adding ancillae qubits enlarges our Hilbert space
(say from $\mathcal{V}$ to $\mathcal{V}\otimes \mathcal{J}$),
and discarding ancillae qubits shrinks our Hilbert space
(say from $\mathcal{V}\otimes \mathcal{J}$ back to $\mathcal{V}$),
and these are more properly represented by isometries $\hat{U}$,
or non-square matrices
of dimension
$\dim(\mathcal{V})\times \dim(\mathcal{V})\cdot\dim(J)$
(or the transpose of that), which are unital in that
$\hat{U}\hat{U}^\dagger = I$. To convert between the two matrix sizes,
so that we can combine unitary and unital operators, we can use the
standard embedding as in \cite{Kitaev2002}:

\begin{equation}
\forall \ket{\xi} \in \mathcal{V} \qquad V\ket{\xi} = \ket{\xi} \otimes \ket{0^N}
\end{equation}

However, in these notes, we take the equivalent approach of just
tensoring a unitary operator without ancillae with identity on the
ancillae Hilbert space ($U \otimes I_{\mathcal{B}^{\otimes N}}$).

For unitary operators, the input and output vector spaces are the same,
so we will often just write them in the following notation instead of
the usual $U: \mathcal{V} \rightarrow \mathcal{V}$.

\begin{equation}
U : \mathcal{V}
\end{equation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Operators That Measure a Function}
\label{sec:meas-func}

We now introduce the idea that an operator can measure a function
from the indices of the measurement object space $\mathcal{N}$
to the measurement instrument space $\mathcal{K}$ with respect to
some fixed orthogonal decompositions of these spaces.

\begin{equation}
\mathcal{N} = \bigotimes_{j \in \Omega} \qquad
\mathcal{K} = \bigotimes_{y \in \Delta} \qquad
f:\Omega \rightarrow \Delta
\end{equation}

Saying that an operator $Y$ is measuring with respect to a fixed
orthogonal decomposition $\Omega$ is equivalent to saying that
$Y$ measures the function $f$, which need not even be reversible.
The simplest, but not the most general, form of such an operator projects
the first subsystem $\mathcal{N}$ into a subspace $\mathcal{L}_j$
and performs the
corresponding operation $Q_{f(j)}$ on the second subsystem $\mathcal{K}$.
In Equation \ref{eqn:y-ideal}, we define $Y$ as the sum of these projectors,
and our notation means it operates on the space of $\mathcal{N}$
tensored with $\mathcal{K}$.

\begin{equation}
Y = \sum_{j \in \Omega} \Pi_{\mathcal{L}_j} \otimes Q_{f(j)} : \mathcal{N} \otimes \mathcal{K}
\label{eqn:y-ideal}
\end{equation}
